// –í–æ—Ä–æ–Ω–∫–∞


// function updateDataFromYandexFunnel() {
//   var ss = SpreadsheetApp.getActiveSpreadsheet();
//   var calculationSheet = ss.getSheetByName('–†–∞—Å—á–µ—Ç—ã'); // –õ–∏—Å—Ç —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –º–µ—Å—è—Ü–µ–º –∏ –≥–æ–¥–æ–º
//   var yandexSheet = ss.getSheetByName('–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)'); // –õ–∏—Å—Ç "–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)"

//   if (!yandexSheet) {
//     Logger.log('–õ–∏—Å—Ç "–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
//     return;
//   }

//   // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞ –∏–∑ —è—á–µ–µ–∫ H2 –∏ F2
//   var selectedMonth = getValue(calculationSheet, 'H2');
//   var selectedYear = getValue(calculationSheet, 'F2');

//   // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞ –≤ –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã
//   var monthUpperCase = convertMonthToUpperCase(selectedMonth);

//   // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ª–∏—Å—Ç–∞: "–Ø–ù–í–ê–†–¨ 25" (–º–µ—Å—è—Ü + –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ —Ü–∏—Ñ—Ä—ã –≥–æ–¥–∞)
//   var sheetName = monthUpperCase + ' ' + selectedYear.toString().slice(-2);
//   Logger.log('–§–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞: ' + sheetName);

//   var targetSheet = ss.getSheetByName(sheetName); // –õ–∏—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
//   if (!targetSheet) {
//     Logger.log('–õ–∏—Å—Ç "' + sheetName + '" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
//     return;
//   }

//   var formattedMonthYear = (selectedMonth + ' ' + selectedYear).toUpperCase().trim();
//   Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥: ' + formattedMonthYear);

//   // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞
//   var lastMonthDate = new Date(selectedYear, getMonthNumber(selectedMonth) - 2, 1);
//   var lastMonthName = convertMonthToUpperCase(getMonthNameFromDate(lastMonthDate));
//   var lastYear = lastMonthDate.getFullYear();
//   var formattedLastMonthYear = (lastMonthName + ' ' + lastYear).toUpperCase().trim();
//   Logger.log('–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥: ' + formattedLastMonthYear);

//   var range = yandexSheet.getDataRange();
//   var values = range.getValues();
//   var foundMonth = false;
//   var foundMonthDirty = false;
//   var foundMonthClean = false;

//   // –ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –º–µ—Å—è—Ü–µ–º –∏ –≥–æ–¥–æ–º
//   for (var i = 0; i < values.length; i++) {
//     // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
//     if (values[i][0].toString().toUpperCase() === formattedMonthYear) {
//       // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞–¥ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–µ–∫—Å—Ç "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´
//       if (i > 0 && values[i - 1][0].toString().toUpperCase() === '"–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´') {
//         foundMonth = true;
//         Logger.log('–ù–∞–π–¥–µ–Ω –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–∞ —Å—Ç—Ä–æ–∫–µ: ' + (i + 1));

//         // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ª–∏—Å—Ç–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
//         setValue(targetSheet, 'F159', values[i + 2][1]); // –ë—é–¥–∂–µ—Ç –ü–õ–ê–ù
//         setValue(targetSheet, 'G159', values[i + 2][2]); // –ë—é–¥–∂–µ—Ç –§–ê–ö–¢
//         setValue(targetSheet, 'F160', values[i + 6][1]); // –õ–∏–¥—ã –ü–õ–ê–ù
//         setValue(targetSheet, 'G160', values[i + 6][2]); // –õ–∏–¥—ã –§–ê–ö–¢
//         // setValue(targetSheet, 'F162', values[i + 8][1]); // CV2(–∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±—Ä–æ–Ω—å) –ü–õ–ê–ù
//         // setValue(targetSheet, 'G162', values[i + 8][2]); // CV2(–∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±—Ä–æ–Ω—å) –§–ê–ö–¢
//         setValue(targetSheet, 'F163', values[i + 12][1]); // –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –ü–õ–ê–ù
//         setValue(targetSheet, 'G163', values[i + 12][2]); // –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –§–ê–ö–¢
//         setValue(targetSheet, 'F164', values[i + 10][1]); // –¶–µ–Ω–∞ –Ω–æ—á–∏ –ü–õ–ê–ù
//         setValue(targetSheet, 'G164', values[i + 10][2]); // –¶–µ–Ω–∞ –Ω–æ—á–∏ –§–ê–ö–¢
//         setValue(targetSheet, 'F165', values[i + 13][1]); // –í—ã—Ä—É—á–∫–∞ –ü–õ–ê–ù
//         setValue(targetSheet, 'G165', values[i + 13][2]); // –í—ã—Ä—É—á–∫–∞ –§–ê–ö–¢
//       }

//       // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞–¥ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–µ–∫—Å—Ç "–ß–ò–°–¢–´–ï" –õ–ò–î–´
//       if (i > 0 && values[i - 1][0].toString().toUpperCase() === '"–ß–ò–°–¢–´–ï" –õ–ò–î–´') {
//         foundMonth = true;
//         Logger.log('–ù–∞–π–¥–µ–Ω –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–∞ —Å—Ç—Ä–æ–∫–µ: ' + (i + 1));

//         // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ª–∏—Å—Ç–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
//         setValue(targetSheet, 'F161', values[i + 6][1]); // –ß–∏—Å—Ç—ã–µ –ª–∏–¥—ã –ü–õ–ê–ù
//         setValue(targetSheet, 'G161', values[i + 6][2]); // –ß–∏—Å—Ç—ã–µ –ª–∏–¥—ã –§–ê–ö–¢
//         setValue(targetSheet, 'F162', values[i + 8][1]); // CV2(–∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±—Ä–æ–Ω—å) –ü–õ–ê–ù
//         setValue(targetSheet, 'G162', values[i + 8][2]); // CV2(–∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±—Ä–æ–Ω—å) –§–ê–ö–¢
//       }
//     }

//     // –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´
//     if (values[i][0].toString().toUpperCase() === '"–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´') {
//       if (values[i + 1][0].toString().toUpperCase() === formattedLastMonthYear) {
//         foundMonthDirty = true;
//         Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ì–†–Ø–ó–ù–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (i + 2));

//         // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä—è–∑–Ω—ã—Ö –ª–∏–¥–æ–≤ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ –ª–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
//         var budgetFromAJ = values[i + 3][35];
//         Logger.log('üìå –ó–∞–ø–∏—Å—å –±—é–¥–∂–µ—Ç–∞ –≤ "–†–∞—Å—á–µ—Ç—ã" -> A40 –∏–∑ AJ: ' + budgetFromAJ);
//         setValue(calculationSheet, 'A40', budgetFromAJ); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —è—á–µ–π–∫—É A40 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"

//         // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –õ–∏–¥—ã –ì–†–Ø–ó–ù–´–ï –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ –ª–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
//         var dirtyLeadsFromAJ = values[i + 7][35];
//         Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ì–†–Ø–ó–ù–´–ï –≤ "–†–∞—Å—á–µ—Ç—ã" -> A64 –∏–∑ AJ: ' + dirtyLeadsFromAJ);
//         setValue(calculationSheet, 'A64', dirtyLeadsFromAJ); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —è—á–µ–π–∫—É A64 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
//       }
//     }

//     // –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ —Ä–∞–∑–¥–µ–ª–µ "–ß–ò–°–¢–´–ï" –õ–ò–î–´
//     if (values[i][0].toString().toUpperCase() === '"–ß–ò–°–¢–´–ï" –õ–ò–î–´') {
//       if (values[i + 1][0].toString().toUpperCase() === formattedLastMonthYear) {
//         foundMonthClean = true;
//         Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ß–ò–°–¢–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (i + 7));

//         // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —á–∏—Å—Ç—ã—Ö –ª–∏–¥–æ–≤ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ –ª–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
//         var cleanLeadsFromAJ = values[i + 7][35];
//         Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ß–ò–°–¢–´–ï –≤ "–†–∞—Å—á–µ—Ç—ã" -> A71 –∏–∑ AJ: ' + cleanLeadsFromAJ);
//         setValue(calculationSheet, 'A71', cleanLeadsFromAJ); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —è—á–µ–π–∫—É A71 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
//       }
//     }
//   }

//   if (!foundMonth) {
//     Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –ª–∏—Å—Ç–µ "–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)" –∏–ª–∏ –Ω–∞–¥ –Ω–∏–º–∏ –Ω–µ—Ç —Å—Ç—Ä–æ–∫–∏ "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´.');
//   }

//   if (!foundMonthDirty) {
//     Logger.log('–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´.');
//   }

//   if (!foundMonthClean) {
//     Logger.log('–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ß–ò–°–¢–´–ï" –õ–ò–î–´.');
//   }
// }



function updateDataFromYandexFunnel() {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var calculationSheet = ss.getSheetByName('–†–∞—Å—á–µ—Ç—ã'); // –õ–∏—Å—Ç —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –º–µ—Å—è—Ü–µ–º –∏ –≥–æ–¥–æ–º
  var yandexSheet = ss.getSheetByName('–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)'); // –õ–∏—Å—Ç "–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)"

  if (!yandexSheet) {
    Logger.log('–õ–∏—Å—Ç "–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
    return;
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞ –∏–∑ —è—á–µ–µ–∫ H2 –∏ F2
  var selectedMonth = getValue(calculationSheet, 'H2');
  var selectedYear = getValue(calculationSheet, 'F2');

  // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞ –≤ –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã
  var monthUpperCase = convertMonthToUpperCase(selectedMonth);

  // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ª–∏—Å—Ç–∞: "–Ø–ù–í–ê–†–¨ 25" (–º–µ—Å—è—Ü + –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ —Ü–∏—Ñ—Ä—ã –≥–æ–¥–∞)
  var sheetName = monthUpperCase + ' ' + selectedYear.toString().slice(-2);
  Logger.log('–§–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞: ' + sheetName);

  var targetSheet = ss.getSheetByName(sheetName); // –õ–∏—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
  if (!targetSheet) {
    Logger.log('–õ–∏—Å—Ç "' + sheetName + '" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
    return;
  }

  var formattedMonthYear = (selectedMonth + ' ' + selectedYear).toUpperCase().trim();
  Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥: ' + formattedMonthYear);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞
  var lastMonthDate = new Date(selectedYear, getMonthNumber(selectedMonth) - 2, 1);
  var lastMonthName = convertMonthToUpperCase(getMonthNameFromDate(lastMonthDate));
  var lastYear = lastMonthDate.getFullYear();
  var formattedLastMonthYear = (lastMonthName + ' ' + lastYear).toUpperCase().trim();
  Logger.log('–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥: ' + formattedLastMonthYear);

  var range = yandexSheet.getDataRange();
  var values = range.getValues();
  var foundMonth = false;
  var foundMonthDirty = false;
  var foundMonthClean = false;

  // –ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –º–µ—Å—è—Ü–µ–º –∏ –≥–æ–¥–æ–º
  for (var i = 0; i < values.length; i++) {
    // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
    if (values[i][0].toString().toUpperCase() === formattedMonthYear) {
      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞–¥ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–µ–∫—Å—Ç "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´
      if (i > 0 && values[i - 1][0].toString().toUpperCase() === '"–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´') {
        foundMonth = true;
        Logger.log('–ù–∞–π–¥–µ–Ω –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–∞ —Å—Ç—Ä–æ–∫–µ: ' + (i + 1));

        // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ª–∏—Å—Ç–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
        setValue(targetSheet, 'F159', values[i + 2][1]); // –ë—é–¥–∂–µ—Ç –ü–õ–ê–ù
        setValue(targetSheet, 'G159', values[i + 2][2]); // –ë—é–¥–∂–µ—Ç –§–ê–ö–¢
        setValue(targetSheet, 'F160', values[i + 6][1]); // –õ–∏–¥—ã –ü–õ–ê–ù
        setValue(targetSheet, 'G160', values[i + 6][2]); // –õ–∏–¥—ã –§–ê–ö–¢
        setValue(targetSheet, 'F163', values[i + 12][1]); // –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –ü–õ–ê–ù
        setValue(targetSheet, 'G163', values[i + 12][2]); // –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –§–ê–ö–¢
        setValue(targetSheet, 'F164', values[i + 10][1]); // –¶–µ–Ω–∞ –Ω–æ—á–∏ –ü–õ–ê–ù
        setValue(targetSheet, 'G164', values[i + 10][2]); // –¶–µ–Ω–∞ –Ω–æ—á–∏ –§–ê–ö–¢
        setValue(targetSheet, 'F165', values[i + 13][1]); // –í—ã—Ä—É—á–∫–∞ –ü–õ–ê–ù
        setValue(targetSheet, 'G165', values[i + 13][2]); // –í—ã—Ä—É—á–∫–∞ –§–ê–ö–¢

        // –ó–∞–ø–∏—Å—å –±—é–¥–∂–µ—Ç–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ C40 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
        var budgetFromAJCurrentYan = values[i + 2][35]; // –ë—é–¥–∂–µ—Ç –§–ê–ö–¢ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ AJ
        Logger.log('üìå –ó–∞–ø–∏—Å—å –±—é–¥–∂–µ—Ç–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ "–†–∞—Å—á–µ—Ç—ã" -> C40 –∏–∑ AJ: ' + budgetFromAJCurrentYan);
        setValue(calculationSheet, 'budgetYanCurr', budgetFromAJCurrentYan || 0); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ C40, 0 –µ—Å–ª–∏ undefined

        // –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ C64 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
        var dirtyLeadsFromAJCurrent = values[i + 6][35]; // –õ–∏–¥—ã –§–ê–ö–¢ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ AJ
        Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ì–†–Ø–ó–ù–´–ï –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ "–†–∞—Å—á–µ—Ç—ã" -> C64 –∏–∑ AJ: ' + dirtyLeadsFromAJCurrent);
        setValue(calculationSheet, 'C64', dirtyLeadsFromAJCurrent || 0); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ C64, 0 –µ—Å–ª–∏ undefined
      }

      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞–¥ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–µ–∫—Å—Ç "–ß–ò–°–¢–´–ï" –õ–ò–î–´
      if (i > 0 && values[i - 1][0].toString().toUpperCase() === '"–ß–ò–°–¢–´–ï" –õ–ò–î–´') {
        foundMonth = true;
        Logger.log('–ù–∞–π–¥–µ–Ω –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–∞ —Å—Ç—Ä–æ–∫–µ: ' + (i + 1));

        // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ª–∏—Å—Ç–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
        setValue(targetSheet, 'F161', values[i + 6][1]); // –ß–∏—Å—Ç—ã–µ –ª–∏–¥—ã –ü–õ–ê–ù
        setValue(targetSheet, 'G161', values[i + 6][2]); // –ß–∏—Å—Ç—ã–µ –ª–∏–¥—ã –§–ê–ö–¢
        setValue(targetSheet, 'F162', values[i + 8][1]); // CV2(–∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±—Ä–æ–Ω—å) –ü–õ–ê–ù
        setValue(targetSheet, 'G162', values[i + 8][2]); // CV2(–∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±—Ä–æ–Ω—å) –§–ê–ö–¢

        // –ó–∞–ø–∏—Å—å —á–∏—Å—Ç—ã—Ö –ª–∏–¥–æ–≤ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ C65 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
        var cleanLeadsFromAJCurrent = values[i + 6][35]; // –ß–∏—Å—Ç—ã–µ –ª–∏–¥—ã –§–ê–ö–¢ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ AJ
        Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ß–ò–°–¢–´–ï –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ "–†–∞—Å—á–µ—Ç—ã" -> C65 –∏–∑ AJ: ' + cleanLeadsFromAJCurrent);
        setValue(calculationSheet, 'C65', cleanLeadsFromAJCurrent || 0); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ C65, 0 –µ—Å–ª–∏ undefined
      }
    }

    // –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´
    if (values[i][0].toString().toUpperCase() === '"–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´') {
      if (values[i + 1][0].toString().toUpperCase() === formattedLastMonthYear) {
        foundMonthDirty = true;
        Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ì–†–Ø–ó–ù–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (i + 2));

        // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä—è–∑–Ω—ã—Ö –ª–∏–¥–æ–≤ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ –ª–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
        var budgetFromAJYan = values[i + 3][35];
        Logger.log('üìå –ó–∞–ø–∏—Å—å –±—é–¥–∂–µ—Ç–∞ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ "–†–∞—Å—á–µ—Ç—ã" -> A40 –∏–∑ AJ: ' + budgetFromAJYan);
        setValue(calculationSheet, 'budgetYanLast', budgetFromAJYan); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —è—á–µ–π–∫—É A40 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"

        // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –õ–∏–¥—ã –ì–†–Ø–ó–ù–´–ï –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ –ª–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
        var dirtyLeadsFromAJ = values[i + 7][35];
        Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ì–†–Ø–ó–ù–´–ï –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ "–†–∞—Å—á–µ—Ç—ã" -> C108 –∏–∑ AJ: ' + dirtyLeadsFromAJ); //A64
        setValue(calculationSheet, 'AllLeadYanLast', dirtyLeadsFromAJ); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —è—á–µ–π–∫—É C108 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
      }
    }

    // –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ —Ä–∞–∑–¥–µ–ª–µ "–ß–ò–°–¢–´–ï" –õ–ò–î–´
    if (values[i][0].toString().toUpperCase() === '"–ß–ò–°–¢–´–ï" –õ–ò–î–´') {
      if (values[i + 1][0].toString().toUpperCase() === formattedLastMonthYear) {
        foundMonthClean = true;
        Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ß–ò–°–¢–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (i + 7));

        // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —á–∏—Å—Ç—ã—Ö –ª–∏–¥–æ–≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ –ª–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
        var cleanLeadsFromAJ = values[i + 7][35];
        Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ß–ò–°–¢–´–ï –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ "–†–∞—Å—á–µ—Ç—ã" -> A71 –∏–∑ AJ: ' + cleanLeadsFromAJ);
        setValue(calculationSheet, 'cleanLeadYanLast', cleanLeadsFromAJ); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —è—á–µ–π–∫—É A71 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
      }
    }
  }

  if (!foundMonth) {
    Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –ª–∏—Å—Ç–µ "–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)" –∏–ª–∏ –Ω–∞–¥ –Ω–∏–º–∏ –Ω–µ—Ç —Å—Ç—Ä–æ–∫–∏ "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´.');
  }

  if (!foundMonthDirty) {
    Logger.log('–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´.');
  }

  if (!foundMonthClean) {
    Logger.log('–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ß–ò–°–¢–´–ï" –õ–ò–î–´.');
  }
}




// function updateDataFromCianFunnel() {
//   var ss = SpreadsheetApp.getActiveSpreadsheet();
//   var calculationSheet = ss.getSheetByName('–†–∞—Å—á–µ—Ç—ã'); // –õ–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
//   var cianSheet = ss.getSheetByName('–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)'); // –õ–∏—Å—Ç "–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)"

//   if (!cianSheet) {
//     Logger.log('–õ–∏—Å—Ç "–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
//     return;
//   }

//   // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞ –∏–∑ —è—á–µ–µ–∫ H2 –∏ F2
//   var selectedMonth = calculationSheet.getRange('H2').getValue();
//   var selectedYear = calculationSheet.getRange('F2').getValue();

//   // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞ –≤ –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã
//   var monthUpperCase = selectedMonth.toUpperCase();

//   // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ª–∏—Å—Ç–∞: "–Ø–ù–í–ê–†–¨ 25" (–º–µ—Å—è—Ü + –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ —Ü–∏—Ñ—Ä—ã –≥–æ–¥–∞)
//   var sheetName = monthUpperCase + ' ' + selectedYear.toString().slice(-2);
//   Logger.log('–§–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞: ' + sheetName);

//   var targetSheet = ss.getSheetByName(sheetName); // –õ–∏—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
//   if (!targetSheet) {
//     Logger.log('–õ–∏—Å—Ç "' + sheetName + '" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
//     return;
//   }

//   var formattedMonthYear = (selectedMonth + ' ' + selectedYear).toUpperCase().trim();
//   Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥: ' + formattedMonthYear);

//   // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞
//   var lastMonthDate = new Date(selectedYear, getMonthNumber(selectedMonth) - 2, 1);
//   var lastMonthName = convertMonthToUpperCase(getMonthNameFromDate(lastMonthDate));
//   var lastYear = lastMonthDate.getFullYear();
//   var formattedLastMonthYear = (lastMonthName + ' ' + lastYear).toUpperCase().trim();
//   Logger.log('–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥: ' + formattedLastMonthYear);

//   var range = cianSheet.getDataRange();
//   var values = range.getValues();
//   var foundMonthDirty = false;
//   var foundMonthClean = false;

//   // üîπ –û–±—Ö–æ–¥ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ –≤ "–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)"
//   for (var i = 0; i < values.length - 1; i++) {
//     // üîπ –ü–æ–∏—Å–∫ "–ì–†–Ø–ó–ù–´–•" –õ–ò–î–û–í
//     if (values[i][0].toString().toUpperCase() === '"–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´') {
//       if (values[i + 1][0].toString().toUpperCase() === formattedMonthYear) {
//         foundMonthDirty = true;
//         Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ì–†–Ø–ó–ù–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (i + 2));

//         // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä—è–∑–Ω—ã—Ö –ª–∏–¥–æ–≤
//         updateCianData(targetSheet, cianSheet, i + 2, "–ë—é–¥–∂–µ—Ç", 167);
//         updateCianData(targetSheet, cianSheet, i + 2, "–õ–∏–¥—ã –ì–†–Ø–ó–ù–´–ï", 168);
//         // updateCianData(targetSheet, cianSheet, i + 2, "CV2(–∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±—Ä–æ–Ω—å)", 170);
//         updateCianData(targetSheet, cianSheet, i + 2, "–¶–µ–Ω–∞ –Ω–æ—á–∏", 171);
//         updateCianData(targetSheet, cianSheet, i + 2, "–í—ã—Ä—É—á–∫–∞", 172);
//       }
//     }

//     // üîπ –ü–æ–∏—Å–∫ "–ß–ò–°–¢–´–•" –õ–ò–î–û–í
//     if (values[i][0].toString().toUpperCase() === '"–ß–ò–°–¢–´–ï" –õ–ò–î–´') {
//       if (values[i + 1][0].toString().toUpperCase() === formattedMonthYear) {
//         foundMonthClean = true;
//         Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ß–ò–°–¢–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (i + 2));

//         // üîπ –ü–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫–∏ "–õ–∏–¥—ã –ß–ò–°–¢–´–ï" –ø–æ—Å–ª–µ –º–µ—Å—è—Ü–∞
//         for (var j = i + 2; j < values.length; j++) {
//           if (values[j][0].toString().toUpperCase() === '–õ–ò–î–´ –ß–ò–°–¢–´–ï') {
//             Logger.log('–ù–∞–π–¥–µ–Ω—ã "–õ–∏–¥—ã –ß–ò–°–¢–´–ï" –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (j + 1));

//             // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö (—É–∫–∞–∑–∞–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏, –∑–∞–º–µ–Ω–∏ –Ω–∞ –Ω—É–∂–Ω—ã–µ)
//             updateCianData(targetSheet, cianSheet, j, "–õ–∏–¥—ã –ß–ò–°–¢–´–ï", 166);
//             updateCianData(targetSheet, cianSheet, i + 2, "CV2(–∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±—Ä–æ–Ω—å)", 170);
//             break;
//           }
//         }
//       }
//     }
//   }

//   // –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´
//   for (var k = 0; k < values.length; k++) {
//     if (values[k][0].toString().toUpperCase() === '"–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´') {
//       if (values[k + 1][0].toString().toUpperCase() === formattedLastMonthYear) {
//         foundMonthDirty = true;
//         Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ì–†–Ø–ó–ù–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (k + 2));

//         // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä—è–∑–Ω—ã—Ö –ª–∏–¥–æ–≤ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ –ª–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
//         var budgetFromAJ = values[k + 3][35];
//         Logger.log('üìå –ó–∞–ø–∏—Å—å –±—é–¥–∂–µ—Ç–∞ –≤ "–†–∞—Å—á–µ—Ç—ã" -> A41 –∏–∑ AJ: ' + budgetFromAJ);
//         setValue(calculationSheet, 'A41', budgetFromAJ); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —è—á–µ–π–∫—É A41 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"

//         // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –õ–∏–¥—ã –ì–†–Ø–ó–ù–´–ï –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ –ª–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
//         var dirtyLeadsFromAJ = values[k + 7][35];
//         Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ì–†–Ø–ó–ù–´–ï –≤ "–†–∞—Å—á–µ—Ç—ã" -> A64 –∏–∑ AJ: ' + dirtyLeadsFromAJ);
//         setValue(calculationSheet, 'A65', dirtyLeadsFromAJ); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —è—á–µ–π–∫—É A64 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
//       }
//     }
//   }

//   // –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ —Ä–∞–∑–¥–µ–ª–µ "–ß–ò–°–¢–´–ï" –õ–ò–î–´
//   for (var l = 0; l < values.length; l++) {
//     if (values[l][0].toString().toUpperCase() === '"–ß–ò–°–¢–´–ï" –õ–ò–î–´') {
//       if (values[l + 1][0].toString().toUpperCase() === formattedLastMonthYear) {
//         foundMonthClean = true;
//         Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ß–ò–°–¢–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (l + 2));

//         // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —á–∏—Å—Ç—ã—Ö –ª–∏–¥–æ–≤ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ –ª–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
//         var cleanLeadsFromAJ = values[l + 7][35];
//         Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ß–ò–°–¢–´–ï –≤ "–†–∞—Å—á–µ—Ç—ã" -> A72 –∏–∑ AJ: ' + cleanLeadsFromAJ);
//         setValue(calculationSheet, 'A72', cleanLeadsFromAJ); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —è—á–µ–π–∫—É A72 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
//       }
//     }
//   }

//   if (!foundMonthDirty) {
//     Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´.');
//   }

//   if (!foundMonthClean) {
//     Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ß–ò–°–¢–´–ï" –õ–ò–î–´.');
//   }
// }

function updateDataFromCianFunnel() {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var calculationSheet = ss.getSheetByName('–†–∞—Å—á–µ—Ç—ã'); // –õ–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
  var cianSheet = ss.getSheetByName('–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)'); // –õ–∏—Å—Ç "–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)"

  if (!cianSheet) {
    Logger.log('–õ–∏—Å—Ç "–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
    return;
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞ –∏–∑ —è—á–µ–µ–∫ H2 –∏ F2
  var selectedMonth = calculationSheet.getRange('H2').getValue();
  var selectedYear = calculationSheet.getRange('F2').getValue();

  // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞ –≤ –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã
  var monthUpperCase = selectedMonth.toUpperCase();

  // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ª–∏—Å—Ç–∞: "–Ø–ù–í–ê–†–¨ 25" (–º–µ—Å—è—Ü + –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ —Ü–∏—Ñ—Ä—ã –≥–æ–¥–∞)
  var sheetName = monthUpperCase + ' ' + selectedYear.toString().slice(-2);
  Logger.log('–§–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞: ' + sheetName);

  var targetSheet = ss.getSheetByName(sheetName); // –õ–∏—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
  if (!targetSheet) {
    Logger.log('–õ–∏—Å—Ç "' + sheetName + '" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
    return;
  }

  var formattedMonthYear = (selectedMonth + ' ' + selectedYear).toUpperCase().trim();
  Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥: ' + formattedMonthYear);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞
  var lastMonthDate = new Date(selectedYear, getMonthNumber(selectedMonth) - 2, 1);
  var lastMonthName = convertMonthToUpperCase(getMonthNameFromDate(lastMonthDate));
  var lastYear = lastMonthDate.getFullYear();
  var formattedLastMonthYear = (lastMonthName + ' ' + lastYear).toUpperCase().trim();
  Logger.log('–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥: ' + formattedLastMonthYear);

  var range = cianSheet.getDataRange();
  var values = range.getValues();
  var foundMonthDirty = false;
  var foundMonthClean = false;

  // üîπ –û–±—Ö–æ–¥ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ –≤ "–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)"
  for (var i = 0; i < values.length - 1; i++) {
    // üîπ –ü–æ–∏—Å–∫ "–ì–†–Ø–ó–ù–´–•" –õ–ò–î–û–í
    if (values[i][0].toString().toUpperCase() === '"–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´') {
      if (values[i + 1][0].toString().toUpperCase() === formattedMonthYear) {
        foundMonthDirty = true;
        Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ì–†–Ø–ó–ù–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (i + 2));

        // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä—è–∑–Ω—ã—Ö –ª–∏–¥–æ–≤ –≤ –ª–∏—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
        updateCianData(targetSheet, cianSheet, i + 2, "–ë—é–¥–∂–µ—Ç", 167);
        updateCianData(targetSheet, cianSheet, i + 2, "–õ–∏–¥—ã –ì–†–Ø–ó–ù–´–ï", 168);
        updateCianData(targetSheet, cianSheet, i + 2, "–¶–µ–Ω–∞ –Ω–æ—á–∏", 171);
        updateCianData(targetSheet, cianSheet, i + 2, "–í—ã—Ä—É—á–∫–∞", 172);

        // –ó–∞–ø–∏—Å—å –±—é–¥–∂–µ—Ç–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ C41 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
        var budgetFromAJCurrentCian = values[i + 3][35]; // –ë—é–¥–∂–µ—Ç –§–ê–ö–¢ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ AJ
        Logger.log('üìå –ó–∞–ø–∏—Å—å –±—é–¥–∂–µ—Ç–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ "–†–∞—Å—á–µ—Ç—ã" -> C41 –∏–∑ AJ: ' + budgetFromAJCurrentCian);
        setValue(calculationSheet, 'budgetCianCurr', budgetFromAJCurrentCian || 0); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ C41, 0 –µ—Å–ª–∏ undefined

        // –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ C65 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
        var dirtyLeadsFromAJCurrent = values[i + 6][35]; // –õ–∏–¥—ã –ì–†–Ø–ó–ù–´–ï –§–ê–ö–¢ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ AJ
        Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ì–†–Ø–ó–ù–´–ï –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ "–†–∞—Å—á–µ—Ç—ã" -> C65 –∏–∑ AJ: ' + dirtyLeadsFromAJCurrent);
        setValue(calculationSheet, 'C65', dirtyLeadsFromAJCurrent || 0); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ C65, 0 –µ—Å–ª–∏ undefined
      }
    }

    // üîπ –ü–æ–∏—Å–∫ "–ß–ò–°–¢–´–•" –õ–ò–î–û–í
    if (values[i][0].toString().toUpperCase() === '"–ß–ò–°–¢–´–ï" –õ–ò–î–´') {
      if (values[i + 1][0].toString().toUpperCase() === formattedMonthYear) {
        foundMonthClean = true;
        Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ß–ò–°–¢–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (i + 2));

        // üîπ –ü–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫–∏ "–õ–∏–¥—ã –ß–ò–°–¢–´–ï" –ø–æ—Å–ª–µ –º–µ—Å—è—Ü–∞
        for (var j = i + 2; j < values.length; j++) {
          if (values[j][0].toString().toUpperCase() === '–õ–ò–î–´ –ß–ò–°–¢–´–ï') {
            Logger.log('–ù–∞–π–¥–µ–Ω—ã "–õ–∏–¥—ã –ß–ò–°–¢–´–ï" –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (j + 1));

            // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ –ª–∏—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            updateCianData(targetSheet, cianSheet, j, "–õ–∏–¥—ã –ß–ò–°–¢–´–ï", 166);
            updateCianData(targetSheet, cianSheet, i + 2, "CV2(–∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±—Ä–æ–Ω—å)", 170);

            // –ó–∞–ø–∏—Å—å —á–∏—Å—Ç—ã—Ö –ª–∏–¥–æ–≤ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ C72 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
            var cleanLeadsFromAJCurrent = values[j][35]; // –ß–∏—Å—Ç—ã–µ –ª–∏–¥—ã –§–ê–ö–¢ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ AJ
            Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ß–ò–°–¢–´–ï –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ "–†–∞—Å—á–µ—Ç—ã" -> C72 –∏–∑ AJ: ' + cleanLeadsFromAJCurrent);
            setValue(calculationSheet, 'C72', cleanLeadsFromAJCurrent || 0); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ C72, 0 –µ—Å–ª–∏ undefined
            break;
          }
        }
      }
    }
  }

  // –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´
  for (var k = 0; k < values.length; k++) {
    if (values[k][0].toString().toUpperCase() === '"–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´') {
      if (values[k + 1][0].toString().toUpperCase() === formattedLastMonthYear) {
        foundMonthDirty = true;
        Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ì–†–Ø–ó–ù–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (k + 2));

        // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä—è–∑–Ω—ã—Ö –ª–∏–¥–æ–≤ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ –ª–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
        var budgetFromAJCian = values[k + 3][35];
        Logger.log('üìå –ó–∞–ø–∏—Å—å –±—é–¥–∂–µ—Ç–∞ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ "–†–∞—Å—á–µ—Ç—ã" -> A41 –∏–∑ AJ: ' + budgetFromAJCian);
        setValue(calculationSheet, 'budgetCianLast', budgetFromAJCian); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —è—á–µ–π–∫—É A41 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"

        // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –õ–∏–¥—ã –ì–†–Ø–ó–ù–´–ï –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ –ª–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
        var dirtyLeadsFromAJ = values[k + 7][35];
        Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ì–†–Ø–ó–ù–´–ï –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ "–†–∞—Å—á–µ—Ç—ã" -> C109 –∏–∑ AJ: ' + dirtyLeadsFromAJ);
        setValue(calculationSheet, 'AllLeadCianLast', dirtyLeadsFromAJ); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —è—á–µ–π–∫—É A65 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
      }
    }
  }

  // –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ —Ä–∞–∑–¥–µ–ª–µ "–ß–ò–°–¢–´–ï" –õ–ò–î–´
  for (var l = 0; l < values.length; l++) {
    if (values[l][0].toString().toUpperCase() === '"–ß–ò–°–¢–´–ï" –õ–ò–î–´') {
      if (values[l + 1][0].toString().toUpperCase() === formattedLastMonthYear) {
        foundMonthClean = true;
        Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ß–ò–°–¢–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (l + 2));

        // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —á–∏—Å—Ç—ã—Ö –ª–∏–¥–æ–≤ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ –ª–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
        var cleanLeadsFromAJ = values[l + 7][35];
        Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ß–ò–°–¢–´–ï –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –≤ "–†–∞—Å—á–µ—Ç—ã" -> C113 –∏–∑ AJ: ' + cleanLeadsFromAJ);
        setValue(calculationSheet, 'cleanLeadCianLast', cleanLeadsFromAJ); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —è—á–µ–π–∫—É C113 –Ω–∞ –ª–∏—Å—Ç–µ "–†–∞—Å—á–µ—Ç—ã"
      }
    }
  }

  if (!foundMonthDirty) {
    Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´.');
  }

  if (!foundMonthClean) {
    Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ß–ò–°–¢–´–ï" –õ–ò–î–´.');
  }
}
function updateCianData(targetSheet, cianSheet, startRow, label, targetRow) {
  var values = cianSheet.getDataRange().getValues();

  for (var j = startRow; j < values.length; j++) {
    if (values[j][0].toString().toUpperCase() === label.toUpperCase()) {
      Logger.log('--- –ù–ê–ô–î–ï–ù–û ---');
      Logger.log('–ù–∞–π–¥–µ–Ω–æ "' + label + '" –Ω–∞ —Å—Ç—Ä–æ–∫–µ: ' + (j + 1));

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ª–∏—Å—Ç–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
      var planValue = values[j][1]; // –ü–õ–ê–ù
      var factValue = values[j][2]; // –§–ê–ö–¢

      Logger.log('--- –ò–°–¢–û–ß–ù–ò–ö –î–ê–ù–ù–´–• ---');
      Logger.log('–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è "' + label + '":');
      Logger.log('–ü–ª–∞–Ω: ' + planValue + ', –§–∞–∫—Ç: ' + factValue);
      Logger.log('--- –Ø–ß–ï–ô–ö–ò –î–õ–Ø –ó–ê–ü–ò–°–ò ---');
      Logger.log('–ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ —è—á–µ–π–∫–∏:');
      Logger.log('–õ–∏—Å—Ç "' + targetSheet.getName() + '", —è—á–µ–π–∫–∞ F' + targetRow + ': –ü–ª–∞–Ω');
      Logger.log('–õ–∏—Å—Ç "' + targetSheet.getName() + '", —è—á–µ–π–∫–∞ G' + targetRow + ': –§–∞–∫—Ç');

      targetSheet.getRange('F' + targetRow).setValue(planValue);
      targetSheet.getRange('G' + targetRow).setValue(factValue);

      Logger.log('--- –û–ë–ù–û–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û ---');
      Logger.log('–î–∞–Ω–Ω—ã–µ –¥–ª—è "' + label + '" –æ–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + targetRow + ' –Ω–∞ –ª–∏—Å—Ç–µ "' + targetSheet.getName() + '".');
      Logger.log('–ü–ª–∞–Ω: ' + planValue + ', –§–∞–∫—Ç: ' + factValue);
      return;
    }
  }
}


// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∏—Å—Ç—ã—Ö –∏ –≥—Ä—è—Ö–Ω—ã—Ö –ª–∏–¥–æ–≤ —Å –í–æ—Ä–æ–Ω–∫–∏ –Ø–Ω–¥–µ–∫—Å –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
function fetchDataFromYandexFunnel() {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var calculationSheet = ss.getSheetByName('–†–∞—Å—á–µ—Ç—ã'); // –õ–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
  var yandexSheet = ss.getSheetByName('–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)'); // –õ–∏—Å—Ç "–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)"

  if (!yandexSheet) {
    Logger.log('–õ–∏—Å—Ç "–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
    return;
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞ –∏–∑ —è—á–µ–µ–∫ H2 –∏ F2
  var selectedMonth = getValue(calculationSheet, 'H2');
  var selectedYear = getValue(calculationSheet, 'F2');

  // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞ –≤ –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã
  var monthUpperCase = convertMonthToUpperCase(selectedMonth, 'H2');

  // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ª–∏—Å—Ç–∞: "–Ø–ù–í–ê–†–¨ 25" (–º–µ—Å—è—Ü + –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ —Ü–∏—Ñ—Ä—ã –≥–æ–¥–∞)
  var sheetName = monthUpperCase + ' ' + selectedYear.toString().slice(-2);
  Logger.log('–§–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞: ' + sheetName);

  var targetSheet = ss.getSheetByName(sheetName); // –õ–∏—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
  if (!targetSheet) {
    Logger.log('–õ–∏—Å—Ç "' + sheetName + '" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
    return;
  }

  var formattedMonthYear = (selectedMonth + ' ' + selectedYear).toUpperCase().trim();
  Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥: ' + formattedMonthYear);

  var range = yandexSheet.getDataRange();
  var values = range.getValues();
  var foundMonthDirty = false;
  var foundMonthClean = false;

  // –ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –º–µ—Å—è—Ü–µ–º –∏ –≥–æ–¥–æ–º
  for (var i = 0; i < values.length; i++) {
    if (values[i][0].toString().toUpperCase() === formattedMonthYear) {
      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞–¥ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–µ–∫—Å—Ç "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´
      if (i > 0 && values[i - 1][0].toString().toUpperCase() === '"–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´') {
        foundMonthDirty = true;
        Logger.log('–ù–∞–π–¥–µ–Ω –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ì–†–Ø–ó–ù–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ: ' + (i + 1));

        // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ª–∏—Å—Ç–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
        setValue(targetSheet, 'F159', values[i + 2][1]); // –ë—é–¥–∂–µ—Ç –ü–õ–ê–ù
        setValue(targetSheet, 'G159', values[i + 2][2]); // –ë—é–¥–∂–µ—Ç –§–ê–ö–¢
        setValue(targetSheet, 'F160', values[i + 6][1]); // –õ–∏–¥—ã –ü–õ–ê–ù
        setValue(targetSheet, 'G160', values[i + 6][2]); // –õ–∏–¥—ã –§–ê–ö–¢
        setValue(targetSheet, 'F163', values[i + 12][1]); // –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –ü–õ–ê–ù
        setValue(targetSheet, 'G163', values[i + 12][2]); // –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –§–ê–ö–¢
        setValue(targetSheet, 'F164', values[i + 10][1]); // –¶–µ–Ω–∞ –Ω–æ—á–∏ –ü–õ–ê–ù
        setValue(targetSheet, 'G164', values[i + 10][2]); // –¶–µ–Ω–∞ –Ω–æ—á–∏ –§–ê–ö–¢
        setValue(targetSheet, 'F165', values[i + 13][1]); // –í—ã—Ä—É—á–∫–∞ –ü–õ–ê–ù
        setValue(targetSheet, 'G165', values[i + 13][2]); // –í—ã—Ä—É—á–∫–∞ –§–ê–ö–¢

        // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è "–ì–†–Ø–ó–ù–´–ï" –ª–∏–¥—ã (—Ñ–∞–∫—Ç) –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ C64
        var dirtyLeadsFromAJ = values[i + 6][35]; // –õ–∏–¥—ã –§–ê–ö–¢ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ AJ
        Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ì–†–Ø–ó–ù–´–ï –≤ "–†–∞—Å—á–µ—Ç—ã" -> B108 –∏–∑ AJ: ' + dirtyLeadsFromAJ); //C64
        setValue(calculationSheet, 'AllLeadYanCurr', dirtyLeadsFromAJ || 0); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ B108, 0 –µ—Å–ª–∏ undefined
      }

      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞–¥ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–µ–∫—Å—Ç "–ß–ò–°–¢–´–ï" –õ–ò–î–´
      if (i > 0 && values[i - 1][0].toString().toUpperCase() === '"–ß–ò–°–¢–´–ï" –õ–ò–î–´') {
        foundMonthClean = true;
        Logger.log('–ù–∞–π–¥–µ–Ω –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ß–ò–°–¢–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ: ' + (i + 1));

        // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ª–∏—Å—Ç–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
        setValue(targetSheet, 'F161', values[i + 6][1]); // –ß–∏—Å—Ç—ã–µ –ª–∏–¥—ã –ü–õ–ê–ù
        setValue(targetSheet, 'G161', values[i + 6][2]); // –ß–∏—Å—Ç—ã–µ –ª–∏–¥—ã –§–ê–ö–¢
        setValue(targetSheet, 'F162', values[i + 8][1]); // CV2(–∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±—Ä–æ–Ω—å) –ü–õ–ê–ù
        setValue(targetSheet, 'G162', values[i + 8][2]); // CV2(–∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±—Ä–æ–Ω—å) –§–ê–ö–¢

        // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ "–ß–ò–°–¢–´–ï" –ª–∏–¥—ã (—Ñ–∞–∫—Ç) –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ C71
        var cleanLeadsFromAJ = values[i + 6][35]; // –ß–∏—Å—Ç—ã–µ –ª–∏–¥—ã –§–ê–ö–¢ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ AJ
        Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ß–ò–°–¢–´–ï –≤ "–†–∞—Å—á–µ—Ç—ã" -> C71 –∏–∑ AJ: ' + cleanLeadsFromAJ);
        setValue(calculationSheet, 'cleanLeadYanCurr', cleanLeadsFromAJ || '0'); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ C71, 0 –µ—Å–ª–∏ undefined
      }
    }
  }

  if (!foundMonthDirty) {
    Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´ –Ω–∞ –ª–∏—Å—Ç–µ "–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)".');
  }

  if (!foundMonthClean) {
    Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ß–ò–°–¢–´–ï" –õ–ò–î–´ –Ω–∞ –ª–∏—Å—Ç–µ "–≤–æ—Ä–æ–Ω–∫–∞ (—è–Ω–¥–µ–∫—Å)".');
  }
}

function fetchDataFromCianFunnel() {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var calculationSheet = ss.getSheetByName('–†–∞—Å—á–µ—Ç—ã'); // –õ–∏—Å—Ç "–†–∞—Å—á–µ—Ç—ã"
  var cianSheet = ss.getSheetByName('–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)'); // –õ–∏—Å—Ç "–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)"

  if (!cianSheet) {
    Logger.log('–õ–∏—Å—Ç "–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
    return;
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞ –∏–∑ —è—á–µ–µ–∫ H2 –∏ F2
  var selectedMonth = getValue(calculationSheet, 'H2');
  var selectedYear = getValue(calculationSheet, 'F2');

  // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞ –≤ –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã
  var monthUpperCase = convertMonthToUpperCase(selectedMonth, 'H2');

  // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ª–∏—Å—Ç–∞: "–Ø–ù–í–ê–†–¨ 25" (–º–µ—Å—è—Ü + –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ —Ü–∏—Ñ—Ä—ã –≥–æ–¥–∞)
  var sheetName = monthUpperCase + ' ' + selectedYear.toString().slice(-2);
  Logger.log('–§–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞: ' + sheetName);

  var targetSheet = ss.getSheetByName(sheetName); // –õ–∏—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–Ø–ù–í–ê–†–¨ 25" (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
  if (!targetSheet) {
    Logger.log('–õ–∏—Å—Ç "' + sheetName + '" –Ω–µ –Ω–∞–π–¥–µ–Ω.');
    return;
  }

  var formattedMonthYear = (selectedMonth + ' ' + selectedYear).toUpperCase().trim();
  Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥: ' + formattedMonthYear);

  var range = cianSheet.getDataRange();
  var values = range.getValues();
  var foundMonthDirty = false;
  var foundMonthClean = false;

  // –û–±—Ö–æ–¥ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ –≤ "–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)"
  for (var i = 0; i < values.length - 1; i++) {
    // –ü–æ–∏—Å–∫ "–ì–†–Ø–ó–ù–´–•" –õ–ò–î–û–í
    if (values[i][0].toString().toUpperCase() === '"–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´') {
      if (values[i + 1][0].toString().toUpperCase() === formattedMonthYear) {
        foundMonthDirty = true;
        Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ì–†–Ø–ó–ù–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (i + 2));

        // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä—è–∑–Ω—ã—Ö –ª–∏–¥–æ–≤ –≤ –ª–∏—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
        updateCianData(targetSheet, cianSheet, i + 2, "–ë—é–¥–∂–µ—Ç", 167);
        updateCianData(targetSheet, cianSheet, i + 2, "–õ–∏–¥—ã –ì–†–Ø–ó–ù–´–ï", 168);
        updateCianData(targetSheet, cianSheet, i + 2, "–¶–µ–Ω–∞ –Ω–æ—á–∏", 171);
        updateCianData(targetSheet, cianSheet, i + 2, "–í—ã—Ä—É—á–∫–∞", 172);

        // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è "–ì–†–Ø–ó–ù–´–ï" –ª–∏–¥—ã (—Ñ–∞–∫—Ç) –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ C65
        var dirtyLeadsFromAJ = values[i + 6][35]; // –õ–∏–¥—ã –ì–†–Ø–ó–ù–´–ï –§–ê–ö–¢ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ AJ
        Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ì–†–Ø–ó–ù–´–ï –≤ "–†–∞—Å—á–µ—Ç—ã" -> B109 –∏–∑ AJ: ' + dirtyLeadsFromAJ);
        setValue(calculationSheet, 'AllLeadCianCurr', dirtyLeadsFromAJ || 0); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ C65, 0 –µ—Å–ª–∏ undefined
      }
    }

    // –ü–æ–∏—Å–∫ "–ß–ò–°–¢–´–•" –õ–ò–î–û–í
    if (values[i][0].toString().toUpperCase() === '"–ß–ò–°–¢–´–ï" –õ–ò–î–´') {
      if (values[i + 1][0].toString().toUpperCase() === formattedMonthYear) {
        foundMonthClean = true;
        Logger.log('–ù–∞–π–¥–µ–Ω –º–µ—Å—è—Ü –∏ –≥–æ–¥ –¥–ª—è "–ß–ò–°–¢–´–•" –õ–ò–î–û–í –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (i + 2));

        // –ü–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫–∏ "–õ–∏–¥—ã –ß–ò–°–¢–´–ï" –ø–æ—Å–ª–µ –º–µ—Å—è—Ü–∞
        for (var j = i + 2; j < values.length; j++) {
          if (values[j][0].toString().toUpperCase() === '–õ–ò–î–´ –ß–ò–°–¢–´–ï') {
            Logger.log('–ù–∞–π–¥–µ–Ω—ã "–õ–∏–¥—ã –ß–ò–°–¢–´–ï" –Ω–∞ —Å—Ç—Ä–æ–∫–µ ' + (j + 1));

            // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ –ª–∏—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            updateCianData(targetSheet, cianSheet, j, "–õ–∏–¥—ã –ß–ò–°–¢–´–ï", 166);
            updateCianData(targetSheet, cianSheet, i + 2, "CV2(–∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±—Ä–æ–Ω—å)", 170);

            // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è "–ß–ò–°–¢–´–ï" –ª–∏–¥—ã (—Ñ–∞–∫—Ç) –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ B113
            var cleanLeadsFromAJ = values[j][35]; // –ß–∏—Å—Ç—ã–µ –ª–∏–¥—ã –§–ê–ö–¢ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ AJ
            Logger.log('üìå –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤ –ß–ò–°–¢–´–ï –≤ "–†–∞—Å—á–µ—Ç—ã" -> B113 –∏–∑ AJ: ' + cleanLeadsFromAJ);
            setValue(calculationSheet, 'cleanLeadCianCurr', cleanLeadsFromAJ || 0); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ B113, 0 –µ—Å–ª–∏ undefined
            break;
          }
        }
      }
    }
  }

  if (!foundMonthDirty) {
    Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì–†–Ø–ó–ù–´–ï" –õ–ò–î–´ –Ω–∞ –ª–∏—Å—Ç–µ "–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)".');
  }

  if (!foundMonthClean) {
    Logger.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ß–ò–°–¢–´–ï" –õ–ò–î–´ –Ω–∞ –ª–∏—Å—Ç–µ "–≤–æ—Ä–æ–Ω–∫–∞ (—Ü–∏–∞–Ω)".');
  }
}